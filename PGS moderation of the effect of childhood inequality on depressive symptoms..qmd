---
title-block-banner: TRUE
title: "The Long Reach of Childhood Income Inequality: A Multinational Twin Study of Gene-Environment Interplay on Adult Depressive Symptoms"
subtitle: "Analytic code with outputs for subsample with genotyping (R version 4.4.2)"
author: 
  - name: Chandra A Reynolds
    id: CAR
    orcid: 0000-0001-6502-7173
    email: chandra.reynolds@colorado.edu
    affiliation: 
      - name: University of Colorado Boulder
        city: Boulder
        state: CO
date: "August 19, 2025"
abstract: "We examine the importance of childhood exposure to uneven distribution of income (i.e., income inequality) in shaping individual differences in adult depressive symptoms, and we test for interplay between genes and inequality using polygenic indices for major depressive disorder as well as estimates of genetic influences based on twin models. Research participants were 69,973 members of twin studies from four developed countries born between 1893 and 1979, and aged 26 to 103 at the time of assessment of depressive symptoms. Income inequality exposure was operationalized as the share of income accruing to the top 1% for each country when the participant was age 10. Income inequality exposure at age 10 was associated with depressive symptom scores in adulthood, adjusting for a host of covariates. Each 1% rise in inequality was associated with a 0.20 higher T-score standardized depressive symptom score. Further, genotyping was available for 6,251 participants. Interaction models showed that among men, but not women, a higher genetic index score for depression augmented the strength of the association between childhood income inequality and depressive symptoms. Twin models based on the entire analytic sample also showed that childhood income inequality moderated genetic variance underlying depressive symptoms, with higher heritability at higher levels of childhood income inequality. Results underscore the long reach of childhood exposure to income inequality and illustrate the interplay of genetic risk with adverse environmental exposures."
format:
  html:
    embed-resources: true
    toc: TRUE
    toc-location: body
editor: visual
echo: TRUE
df-print: kable
---

```{r}
#| label: Load R packages
#| warning: false
#| include: false
#| echo: false
#create working directory to save mplus input and output files

#setwd("/Users/drew/Library/CloudStorage/OneDrive-UniversityofSouthernCalifornia/IGEMS 2023/inequality gxe depression/mplus/input")
setwd("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/mplus/input")
getwd()
# load packages -----------------------------------------------------------

require(sas7bdat)
require(psych)
require(brolgar)
require(lcmm)
require(nlive)
require(gtsummary)
require(nlraa)
require(nlme)
require(MplusAutomation)
require(ggplot2)
require(dplyr)
require(tidyr)
require(knitr)
library(dplyr)
library(ggplot2)
```

## Data Merges, Wrangling

```{r}
#| label: Data wrangling prior to analysis
#| warning: false
#| include: false
#| echo: false
#| 
# load igems depression data data ---------------------------------------------------------
igems<-read.sas7bdat("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/Data/Derived/igems_long_dep_rmdd_06july2024.sas7bdat")
igems2<-igems[c("pairid","twin","study", "studyC","country", "zygos", "sex", "rank","freq","age_dep","depression", "DOB_YY","AGE_DEATH","isced","siops08","r_mdd","mdd_howard2019_Zpgs","pc1", "pc2", "pc3", "pc4", "pc5", "pc6", "pc7", "pc8", "pc9", "pc10")]
#head(igems2)

#load danish data (generated from the "prepare danish depression data 11apr24.R script)
danish<-read.csv("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/Data/Base/PRJ_2023_009_out3/danish_long_dep_pgs_05July2024.csv")
#head(danish)
danish$mdd_howard2019_Zpgs<-scale(danish$MDD_Howard2019_ss,center=T,scale=T)
#head(danish)
danish2<-danish[c("pairid","twin","study", "studyC","country", "zygos", "sex", "rank","freq","age_dep","depression", "DOB_YY","AGE_DEATH","isced","siops08","r_mdd","mdd_howard2019_Zpgs","pc1", "pc2", "pc3", "pc4", "pc5", "pc6", "pc7", "pc8", "pc9", "pc10")]

igems2<-rbind(igems2,danish2)
#head(igems2)
#describe(igems2)
igems3<-igems2
igems3$isced<-as.numeric(igems2$isced)
igems3$siops08<-as.numeric(igems2$siops08)

# load country-level inequality data ----------------------------------------------------
ineq<-read.csv("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/Data/Derived/P23-01-Petkus-Depression/country_level_inequality.csv")
#head(ineq)

# change variable names for merging with igems data -----------------------
#### copy the year for merging inequality data at multiple time points
ineq$yearDEP<-ineq$year
ineq$year10<-ineq$year
ineq$year<-NULL

### rescaling the inequality data so coefficients make more sense in models
ineq$ineq10<-ineq$ineqR*100
ineq$ineqD<-ineq$ineqR*100

### ineq10 represents inequality data at age 10
### ineqDEP represents inequality data at time of depressive symptom assessment
ineq10<-ineq[c("country2","year10","ineq10")]
ineqDEP<-ineq[c("country2","yearDEP", "ineqD")]

# merge inequality with igems depression data -----------------------------
#### generate the year where individuals were 10 years old
igems3$year10<-igems3$DOB_YY+10

#### generate the year when depressive symptoms were assessed
igems3$yearDEP<-round(igems3$DOB_YY+igems3$age_dep)

#### recode country variable so USA studies are United States instead of respective study
igems3$country2<-ifelse(igems3$country=="MIDUS" |
                          igems3$country=="MTSADA" |
                          igems3$country=="NAS-NRC" |
                          igems3$country=="VETSA" |
                          igems3$country=="CAATSA", "United States", igems3$country)
table(igems3$country, igems3$country2)

##merge inequality data
data1<-merge(igems3,ineq10, by=c("year10","country2"), all.x=TRUE)
data2<-merge(data1,ineqDEP, by=c("yearDEP", "country2"), all.x=TRUE)
head(data2)

# merge gdp and educational inequality ---------------------------------------------------------------
ses<-read.sas7bdat("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/Data/Derived/P23-01-Petkus-Depression/country_level_vars_20181108.sas7bdat")
#head(ses)
table(ses$country)

##recode year again so there is a year10 and yearDEP for merging purposes
ses$year10<-ses$year
ses$yearDEP<-ses$year
ses$country2<-ses$country
#head(ses)

## remove finland and data prior to 1900 for graphing purposes
ses2<-subset(ses, year>=1900 & country2!="Finland")

###rename gdp for gdp10 and gdpDep for merging purposes
### gdp10 is gdp at age 10
### gdpD is gdp at the time of depressive symptom assessment
ses$gdp10<-ses$Real_GDP_per_capita_2011US
ses$gdpD<-ses$Real_GDP_per_capita_2011US

ses10<-ses[c("country2","year10","gdp10","ed_inequal")]
sesD<-ses[c("country2","yearDEP","gdpD")]

###merge gdp data with the igems depression data
data2<-merge(data2, ses10, by=c("country2","year10"))
data3<-merge(data2, sesD, by=c("country2","yearDEP"))
head(data3)

# select only first observations for descriptive table ------------------------------------------
#select only cases without missing zygosity and inequality data
data4<-subset(data3, rank==1 & !is.na(ineq10) & !is.na(ineqD) & !is.na(zygos))
describe(data4)

data4$sexF[data4$sex==1]<-"Male"
data4$sexF[data4$sex==2]<-"Female"

data4$zygosC[data4$zygos==1]<-"MZ"
data4$zygosC[data4$zygos==2]<-"DZ"
data4$zygosC[data4$zygos==3]<-"OS"

# remove Danish cases with occupational prestige and education of 99 or 999 --------
describe(data4)

#center inequality on 10
data4$inq10c<-data4$ineq10-10
data4$inqDc<-data4$ineqD-10

#rescale GDP so centered on 12,000 and in units of 1,000
data4$gdp10c<-(data4$gdp10-12000)/1000
head(data4)

#rescale GDP at dep assessment so centered on 35,000 and in units of 1,000
data4$gdpDc<-(data4$gdpD-35000)/1000

#recode sex so 0 and 1
data4$sex0<-data4$sex-1

#T-score standardize depressive symptoms
describe(data4$depression)
data4$depression_sqrt<-sqrt(data4$depression)
data4$depZ<-as.numeric(scale(data4$depression_sqrt))
data4$depT<-(data4$depZ*10)+50
describe(data4$depT)

#create unique pairid for clustering in mplus
data4$pairN<-paste(data4$pairid,data4$study,sep="_")

##model 1 age and sex on depressive symptoms
## center at age 70 for piecewise linear model
data4$t1<-ifelse(data4$age_dep<70, data4$age_dep-70, 0)
data4$t2<-ifelse(data4$age_dep>=70, data4$age_dep-70, 0)
head(data4)
describe(data4)

###remove participants with missing education, education inequality, and job prestige
## CR added code to set 99 and 999 to missing
data4$isced[data4$isced == 99] <- NA
data4$siops08[data4$siops08 == 999] <- NA

data5<-subset(data4, !is.na(ed_inequal) & !is.na(isced)) #& !is.na(siops08)
data5$isced<-ifelse(data5$isced==99, NA, data5$isced)
data5$siops08<-ifelse(data5$siops08==999, NA, data5$siops08)

MISSING <- subset(data4,is.na(siops08))
table(MISSING$studyC)
table(data5$studyC)
table(data5$isced)
describe(data5$siops08)
describe(data5)

hist(data5$ineq10, main="Inequality at age 10", xlab= "Top 1% index", col="red")
hist(data5$ineqD, main="Inequality at time of assessment", xlab= "Top 1% index", col="blue")
hist(data5$isced, main="Educational attainment (ISCED)", xlab= "ISCED", col="green")
hist(data5$siops08, main="Occupational prestige", xlab="siops08", col="orange")

# additional centered variable creation for Mplus models --------
#center education on 4
table(data5$isced)
data5$isco4<-data5$isced-4
table(data5$isco4)

#z score standardize occupational prestige
describe(data5$siops08)
data5$occZ<-as.numeric(scale(data5$siops08))

##model 2 PGS x Inequality
data5$inq10c_rmdd<-data5$inq10c*data5$r_mdd
data5$gdp10c_rmdd<-data5$gdp10c*data5$r_mdd
data5$gdp10c_inq10c<-data5$gdp10c*data5$inq10c
describe(data5$inq10c)

# calculate quartile of PGS
data5 %>%   summarize(first=quantile(r_mdd,probs=0.25),
            second=quantile(r_mdd,probs=0.5),
            third=quantile(r_mdd,probs=0.75))

data5 %>% mutate(q4_rmdd = ntile(r_mdd, 4)) %>% 
  head(6)

data5$q4_rmdd <- with(data5, cut(r_mdd, 
                                breaks=quantile(r_mdd, probs=seq(0,1, by=0.25), na.rm=TRUE), 
                                include.lowest=TRUE))
table(data5$q4_rmdd)

#data5$q4f_rmdd <- factor(data5$q4_rmdd, levels=c("1","2","3","4") )
data5$q4n_rmdd <- as.numeric(data5$q4_rmdd)
table(data5$q4n_rmdd)
data5$q4f_rmdd <- as.factor(data5$q4_rmdd)
table(data5$q4f_rmdd)

```

## Plot of inequality over year by country

```{r}
#| label: plot of inequality over year by country
#| warning: false

sesplot<-ggplot(ses2, aes(x=year, y=Real_GDP_per_capita_2011US, color=country2)) +
  geom_point(size=2)+
  geom_line(size=1)+
  theme_bw()+
  scale_x_continuous(name="Year", breaks=c(seq(1900,2010,15)))+
  scale_y_continuous(name="GDP per capita 2011 US dollars", breaks=c(seq(0,50000,10000)))+
  theme(legend.box.background=element_blank(),
        legend.background=element_rect(fill="transparent",size=.5),
        axis.text.x=element_text(colour="black", size=16),
        axis.text.y=element_text(colour="black", size=16),
        axis.title.x=element_text(colour="black", size=16),
        axis.title.y=element_text(colour="black", size=16),
        plot.title=element_text(size=14),
        panel.background=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.grid.minor.y=element_blank(),
        panel.grid.major.y=element_blank(),
        panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank(),
        panel.border=element_rect(colour="black", size=1),
        strip.background=element_blank(),
        strip.text=element_text(size=14),
        axis.line.x=element_line(size=1),
        axis.line.y=element_line(size=1),
        legend.text=element_text(size=12),
        legend.key.width=unit(3,"line"),
        legend.title=element_blank(),
        legend.direction="vertical",
        #       plot.title= element_text(hjust=-.45, vjust=2.12),
        legend.position=c(0.5, 0.8),
        legend.key=element_blank())

sesplot
```

## Supplemental Table S1: Descriptive statistics for PGS subsample

```{r}
# generate a descriptive table with the tbl_summary package ---------------
dtable3 <- data5 %>% select(age_dep, zygosC,country, depression,depression_sqrt, ineq10, gdp10, isced, sexF, year10, yearDEP)

tbl3<-dtable3 %>%
  tbl_summary(
   statistic = list(
      all_continuous() ~ "{mean} ({sd})"
    ),
    digits = all_continuous() ~ 2,
   type = list(isced ~ "continuous"),
    missing = "no",
    label = list(age_dep ~ "Age at first depressive symptom assessment",
                 zygosC ~ "Zygosity",
                 depression ~ "Depressive symptoms",
                 ineq10 ~ "Top 1% at age 10",
                 gdp10 ~ "GDP at age 10",
                 isced ~ "Educational attainment (ISCED)",
                 year10 ~ "Year at age 10",
                 yearDEP ~ "Year at Assessment",
                 country ~ "Country")) |>
  add_ci(pattern = "{stat} ({ci})",
         style_fun = everything() ~ purrr::partial(style_number, digits = 2))

tbl3
```

## MPlus Model Fitting with PGS subsample

## Model 1: Does PGS contribute to depressive symptoms in addition to childhood inequality?

```{r}
#| warning: false
#| include: false
#| echo: TRUE
#| label: PGS + inequality

setwd("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/mplus/input")
getwd()
#### PGS ANALYSES 1 ####
##### Initial analyses check for inequality*PGS, adjusting for GDP ##### 

##model 1 PGS & childhood inequality
mod16<-mplusObject(
  TITLE = "model 1 childhood inequal & PGS;",
  
  VARIABLE = "
  USEVARIABLES=
  depT t1
  t2
  sex0 gdp10c
  inq10c r_mdd;

cluster is pairN;

  ",
  
  
  ANALYSIS="

ESTIMATOR=MLR;  
TYPE= COMPLEX; 
  

",
  MODEL= "

depT on t1
t2
sex0
inq10c gdp10c
r_mdd;

  ",
  
OUTPUT= "tech4 tech1 tech2 tech3 sampstat CINTERVAL stand ",
  rdata=data5)

mod16_out <- mplusModeler(mod16, 
                          dataout="igems age growth ineq2.dat",
                          hashfilename = FALSE,
                          modelout = "model 1 childhood inequality and PGS.inp", 
                          run = 1, 
                          writeData=c("always"))
```

Model 1 results

```{r}
#| label: PGS + inequality Estimates
#| 
mod16_out$results$warnings
mod16_out$results$summaries$Observations
mod16_out$results$sampstat
mod16_out$results$parameters$unstandardized
mod16_out$results$parameters$ci.unstandardized
mod16_out$results$summaries
mod16_out$results$tech1$parameterSpecification$BETWEEN
mod16_out$results$data_summary

```

## Model 2: Does PGS moderate the effect of childhood inequality on depressive symptoms?

```{r}
#| warning: false
#| include: false
#| echo: TRUE
#| label: PGS X inequality
#| 
setwd("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/mplus/input")
getwd()
mod17<-mplusObject(
  TITLE = "model 2 childhood inequal by PGS;",
  
  VARIABLE = "
  USEVARIABLES=
  depT t1
  t2
  sex0 gdp10c
  inq10c gdp10c_inq10c
  r_mdd gdp10c_rmdd inq10c_rmdd;

cluster is pairN;

  ",
  
  
  ANALYSIS="

ESTIMATOR=MLR;  
TYPE= COMPLEX; 
  

",
  MODEL= "

depT on t1
t2
sex0 gdp10c
inq10c gdp10c_inq10c
r_mdd gdp10c_rmdd inq10c_rmdd;

  ",
   
  OUTPUT= "tech4 tech1 tech2 tech3 sampstat CINTERVAL stand ",
  rdata=data5)

mod17_out <- mplusModeler(mod17, 
                          dataout="igems age growth ineq2.dat",
                          hashfilename = FALSE,
                          modelout = "model 2 childhood inequality by PGS.inp", 
                          run = 1, 
                          writeData=c("always"))

```

Model 2 Results

```{r}
#| label: PGS x inequality Estimates
#| 
mod17_out$results$warnings
mod17_out$results$summaries$Observations
mod17_out$results$sampstat
mod17_out$results$parameters$unstandardized
mod17_out$results$parameters$ci.unstandardized
mod17_out$results$summaries
mod17_out$results$tech1$parameterSpecification$BETWEEN
mod17_out$results$data_summary
```

## Model 3: Does Sex and PGS moderate the effect of childhood inequality on depressive symptoms?

```{r}
#| warning: false
#| include: false
#| echo: TRUE
#| label: Sex X PGS X inequality

setwd("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/mplus/input")
getwd()
##model 3 Sex PGS x depressive symptom assessment inequality
mod17x<-mplusObject(
  TITLE = "model 3 childhood inequal by PGS, grouping by sex;",
  
  VARIABLE = "
  USEVARIABLES=
  depT t1
  t2 sex
  gdp10c
  inq10c gdp10c_inq10c
  r_mdd gdp10c_rmdd inq10c_rmdd;

  cluster is pairN;
  grouping is sex (1=men,2=women);
  ",
  
  
  ANALYSIS="

ESTIMATOR=MLR;  
TYPE= COMPLEX; 
",
  MODEL= "
depT on t1 (m1)
t2 (m2)
gdp10c (m3)
inq10c (m4) 
gdp10c_inq10c (m8)
r_mdd (m5) 
gdp10c_rmdd (m6)
inq10c_rmdd (m7);


Model women:

depT on t1 (w1)
t2 (w2)
gdp10c (w3)
inq10c (w4) 
gdp10c_inq10c (w8)
r_mdd (w5) 
gdp10c_rmdd (w6)
inq10c_rmdd (w7);

",
  
  OUTPUT= "tech4 tech1 tech2 tech3 sampstat CINTERVAL stand ",
  rdata=data5)

mod17x_out <- mplusModeler(mod17x, 
                          dataout="igems age growth ineq2.dat",
                          hashfilename = FALSE,
                          modelout = "model 3 childhood inequality by PGS and Sex.inp", 
                          run = 1, 
                          writeData=c("always"))
```

Model 3 Results

```{r}
#| label: Sex X PGS x inequality Estimates
#| 
#| 

mod17x_out$results$errors
mod17x_out$results$summaries$Observations
mod17x_out$results$warnings
mod17x_out$results$sampstat
mod17x_out$results$parameters$unstandardized
mod17x_out$results$parameters$ci.unstandardized
mod17x_out$results$summaries
mod17x_out$results$tech1$parameterSpecification$BETWEEN
mod17x_out$results$data_summary


```

## Model 4: Equate Estimates for Males and Females

```{r}
#| warning: false
#| include: false
#| echo: TRUE
#| label: Equate Sex, PGS X inequality

setwd("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/mplus/input")
getwd()
mod17xeq<-mplusObject(
  TITLE = "model 4 childhood inequal by PGS, grouping by sex EQ;",
  
  VARIABLE = "
  USEVARIABLES=
  depT t1
  t2 sex
  gdp10c
  inq10c gdp10c_inq10c
  r_mdd gdp10c_rmdd inq10c_rmdd;

  cluster is pairN;
  grouping is sex (1=men,2=women);
  ",
  
  
  ANALYSIS="

ESTIMATOR=MLR;  
TYPE= COMPLEX; 
",
  MODEL= "
depT on t1 (m1)
t2 (m2)
gdp10c (m3)
inq10c (m4) 
gdp10c_inq10c (m8)
r_mdd (m5) 
gdp10c_rmdd (m6)
inq10c_rmdd (m7);


Model women:

depT on t1 (w1)
t2 (w2)
gdp10c (m3)
inq10c (m4) 
gdp10c_inq10c (m8)
r_mdd (m5) 
gdp10c_rmdd (m6)
inq10c_rmdd (m7);

",
  
  OUTPUT= "tech4 tech1 tech2 tech3 sampstat CINTERVAL stand ",
  rdata=data5)

mod17xeq_out <- mplusModeler(mod17xeq, 
                          dataout="igems age growth ineq2.dat",
                          hashfilename = FALSE,
                          modelout = "model 4 childhood inequality by PGS with Sex equated.inp", 
                          run = 1, 
                          writeData=c("always"))
```

Model 4 Results

```{r}
#| label: PGS x inequality, M=F Estimates
#| 
#| 
mod17xeq_out$results$errors
mod17xeq_out$results$warnings
mod17xeq_out$results$summaries$Observations
mod17xeq_out$results$sampstat
mod17xeq_out$results$parameters$unstandardized
mod17xeq_out$results$parameters$ci.unstandardized
mod17xeq_out$results$summaries
mod17xeq_out$results$tech1$parameterSpecification$BETWEEN
mod17xeq_out$results$data_summary
```

## Model 5: Sex Moderation Reduced, PGS X inequality

```{r final}
#| warning: false
#| include: false
#| echo: TRUE
#| label: Sex Moderation Reduced, PGS X inequality

setwd("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/mplus/input")
getwd()
mod17xf<-mplusObject(
  TITLE = "model 5 childhood inequal by PGS, grouping by sex;",
  
  VARIABLE = "
  USEVARIABLES=
  depT t1
  t2 sex
  gdp10c
  inq10c gdp10c_inq10c
  r_mdd gdp10c_rmdd inq10c_rmdd;

  cluster is pairN;
  grouping is sex (1=men,2=women);
  ",
  
  
  ANALYSIS="

ESTIMATOR=MLR;  
TYPE= COMPLEX; 
",
  MODEL= "
depT on t1 (m1)
t2 (m2)
gdp10c (m3)
inq10c (m4) 
gdp10c_inq10c (m8)
r_mdd (m5) 
gdp10c_rmdd (m6)
inq10c_rmdd (m7);


Model women:

depT on t1 (w1)
t2 (w2)
gdp10c (w3)
inq10c (w4) 
gdp10c_inq10c@0
r_mdd (w5) 
gdp10c_rmdd@0
inq10c_rmdd@0;

",
  
  OUTPUT= "tech4 tech1 tech2 tech3 sampstat CINTERVAL stand ",
  rdata=data5)

mod17xf_out <- mplusModeler(mod17xf, 
                          dataout="igems age growth ineq2.dat",
                          hashfilename = FALSE,
                          modelout = "model 5xf childhood inequality by PGS and Sex.inp", 
                          run = 1, 
                          writeData=c("always"))

```

Model 5 Results

```{r}
#| label: PGS x inequality, M & F differ reduced Estimates
#| 
#| 
mod17xf_out$results$errors
mod17xf_out$results$warnings
mod17xf_out$results$summaries$Observations
mod17xf_out$results$sampstat
mod17xf_out$results$parameters$unstandardized
mod17xf_out$results$parameters$ci.unstandardized
mod17xf_out$results$summaries
mod17xf_out$results$tech1$parameterSpecification$BETWEEN
mod17xf_out$results$data_summary
```

## Model 6: Does childhood inequality contribute similarly to Depressive Sx by PGS quartile?

```{r m20}
#| warning: false
#| include: false
#| echo: TRUE
#| label: PGS quartile x inequality

setwd("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/mplus/input")
getwd()
##model 6 PGS quartile depressive symptom assessment inequality
mod20q4<-mplusObject(
  TITLE = "model 6 childhood inequal by PGS, grouping by PGS quartile;",
  
  VARIABLE = "
  USEVARIABLES=
  depT t1
  t2 q4n_rmdd
  sex0
  gdp10c
  inq10c ;

  cluster is pairN;
  grouping is q4n_rmdd (1=Q1,2=Q2, 3=Q3,4=Q4);
  ",
  
  
  ANALYSIS="

ESTIMATOR=MLR;  
TYPE= COMPLEX; 
",
  MODEL= "
depT on t1 (m1)
t2 (m2)
sex0 (m5)
gdp10c (m3)
inq10c (m4);


Model Q2:

depT on t1 (m1)
t2 (m2)
sex0 (m25)
gdp10c (m23)
inq10c (m24);

Model Q3:

depT on t1 (m1)
t2 (m2)
sex0 (m35)
gdp10c (m33)
inq10c (m34);

Model Q4:

depT on t1 (m1)
t2 (m2)
sex0 (m45)
gdp10c (m43)
inq10c (m44);
",
  
  OUTPUT= "tech4 tech1 tech2 tech3 sampstat CINTERVAL stand ",
  rdata=data5)

mod20q4_out <- mplusModeler(mod20q4, 
                          dataout="igems age growth ineq2.dat",
                          hashfilename = FALSE,
                          modelout = "model 6 childhood inequality by PGS quartile.inp", 
                          run = 1, 
                          writeData=c("always"))



```

Model 6 Results

```{r}
#| label: PGS quartile x inequality Estimates
#| 

mod20q4_out$results$errors
mod20q4_out$results$warnings
mod20q4_out$results$sampstat
mod20q4_out$results$parameters$unstandardized
mod20q4_out$results$parameters$ci.unstandardized
mod20q4_out$results$summaries
mod20q4_out$results$tech1$parameterSpecification$BETWEEN
mod20q4_out$results$data_summary
```

## Model 7: Can we equate estimates across PGS quartile?

```{r}
#| warning: false
#| include: false
#| echo: TRUE
#| label: Equate PGS quartile x inequality

setwd("/Volumes/IGEMS/GxE/Work/GE in-progress/Depression_PGS/mplus/input")
getwd()
mod20q4eq<-mplusObject(
  TITLE = "model 7eq childhood inequal by PGS, grouping by PGS;",
  
  VARIABLE = "
  USEVARIABLES=
  depT t1
  t2 q4n_rmdd
  sex0
  gdp10c
  inq10c ;

  cluster is pairN;
  grouping is q4n_rmdd (1=Q1,2=Q2, 3=Q3,4=Q4);
  ",
  
  
  ANALYSIS="

ESTIMATOR=MLR;  
TYPE= COMPLEX; 
",
  MODEL= "
depT on t1 (m1)
t2 (m2)
sex0 (m5)
gdp10c (m3)
inq10c (m4);


Model Q2:

depT on t1 (m1)
t2 (m2)
sex0 (m5)
gdp10c (m3)
inq10c (m4);

Model Q3:

depT on t1 (m1)
t2 (m2)
sex0 (m5)
gdp10c (m3)
inq10c (m4);

Model Q4:

depT on t1 (m1)
t2 (m2)
sex0 (m5)
gdp10c (m3)
inq10c (m4);
",
  
  OUTPUT= "tech4 tech1 tech2 tech3 sampstat CINTERVAL stand ",
  rdata=data5)

mod20q4eq_out <- mplusModeler(mod20q4eq, 
                          dataout="igems age growth ineq2.dat",
                          hashfilename = FALSE,
                          modelout = "model 7 childhood inequality by PGS quartile equate.inp", 
                          run = 1, 
                          writeData=c("always"))


```

Model 7 Results

```{r}
#| label: PGS quartile x inequality, Equate quartile Estimates
#| 
mod20q4eq_out$results$errors
mod20q4eq_out$results$warnings
mod20q4eq_out$results$sampstat
mod20q4eq_out$results$parameters$unstandardized
mod20q4eq_out$results$parameters$ci.unstandardized
mod20q4eq_out$results$summaries
mod20q4eq_out$results$tech1$parameterSpecification$BETWEEN
mod20q4eq_out$results$data_summary
```

## Compare Model Fits via Likelihood Ratio Tests

```{r}

#Compare PGS quartiles
compareModels(
  mod20q4_out,
  mod20q4eq_out,
  show = "summaries",
  equalityMargin = c(param = 1e-04, pvalue = 1e-04),
  compare = "summaries",
  sort = "none",
  showFixed = FALSE,
  showNS = TRUE,
  diffTest = TRUE)
mod20q4_out$results$parameters$unstandardized
mod20q4eq_out$results$parameters$unstandardized

#Compare Sex free to Sex equal
compareModels(
  mod17x_out,
  mod17xeq_out,
  show = "summaries",
  equalityMargin = c(param = 1e-04, pvalue = 1e-04),
  compare = "summaries",
  sort = "none",
  showFixed = FALSE,
  showNS = TRUE,
  diffTest = TRUE)
mod17x_out$results$parameters$unstandardized
mod17xeq_out$results$parameters$unstandardized


#Compare Sex free versus set interactions to 0 for females
compareModels(
  mod17x_out,
  mod17xf_out,
  show = "summaries",
  equalityMargin = c(param = 1e-04, pvalue = 1e-04),
  compare = "summaries",
  sort = "none",
  showFixed = FALSE,
  showNS = TRUE,
  diffTest = TRUE)
mod17x_out$results$parameters$unstandardized
mod17xf_out$results$parameters$unstandardized
```

## Plot of Model estimates of Final Models

```{r}
#| warning: false
#| include: TRUE
#| echo: TRUE
#| label: parameter estimates of Main effect, Sex, & PGS stratified models

label <- c("PGI","Inequality","GDP",
           "PGI Q1 Inequality","PGI Q2 Inequality","PGI Q3 Inequality","PGI Q4 Inequality", "PGI Q1 GDP", "PGI Q2 GDP", "PGI Q3 GDP", "PGI Q4 GDP",
           "PGI Men","Inequality Men","PGI x Ineq Men","GDP Men","PGI x GDP Men",
           "PGI Women","Inequality Women","PGI x Ineq Women","GDP Women","PGI x GDP Women")
mean  <- c(mod16_out$results$parameters$unstandardized[6,3],
           mod16_out$results$parameters$unstandardized[4,3],
           mod16_out$results$parameters$unstandardized[5,3],
           
           mod20q4_out$results$parameters$unstandardized[5,3],
           mod20q4_out$results$parameters$unstandardized[12,3],
           mod20q4_out$results$parameters$unstandardized[19,3],
           mod20q4_out$results$parameters$unstandardized[26,3],
           mod20q4_out$results$parameters$unstandardized[4,3],
           mod20q4_out$results$parameters$unstandardized[11,3],
           mod20q4_out$results$parameters$unstandardized[18,3],
           mod20q4_out$results$parameters$unstandardized[25,3],

           mod17xf_out$results$parameters$unstandardized[6,3],
           mod17xf_out$results$parameters$unstandardized[4,3],
           mod17xf_out$results$parameters$unstandardized[8,3],
           mod17xf_out$results$parameters$unstandardized[3,3],
           mod17xf_out$results$parameters$unstandardized[7,3],
           
           mod17xf_out$results$parameters$unstandardized[16,3],
           mod17xf_out$results$parameters$unstandardized[14,3],
           mod17xf_out$results$parameters$unstandardized[18,3],
           mod17xf_out$results$parameters$unstandardized[13,3],
           mod17xf_out$results$parameters$unstandardized[17,3]) 

lower <- c(mod16_out$results$parameters$ci.unstandardized[6,4],
           mod16_out$results$parameters$ci.unstandardized[4,4],
           mod16_out$results$parameters$ci.unstandardized[5,4],
           
           mod20q4_out$results$parameters$ci.unstandardized[5,4],
           mod20q4_out$results$parameters$ci.unstandardized[12,4],
           mod20q4_out$results$parameters$ci.unstandardized[19,4],
           mod20q4_out$results$parameters$ci.unstandardized[26,4],
           mod20q4_out$results$parameters$ci.unstandardized[4,4],
           mod20q4_out$results$parameters$ci.unstandardized[11,4],
           mod20q4_out$results$parameters$ci.unstandardized[18,4],
           mod20q4_out$results$parameters$ci.unstandardized[25,4],
           
           mod17xf_out$results$parameters$ci.unstandardized[6,4],
           mod17xf_out$results$parameters$ci.unstandardized[4,4],
           mod17xf_out$results$parameters$ci.unstandardized[8,4],
           mod17xf_out$results$parameters$ci.unstandardized[3,4],
           mod17xf_out$results$parameters$ci.unstandardized[7,4],     
           
           mod17xf_out$results$parameters$ci.unstandardized[16,4],
           mod17xf_out$results$parameters$ci.unstandardized[14,4],
           mod17xf_out$results$parameters$ci.unstandardized[18,4],
           mod17xf_out$results$parameters$ci.unstandardized[13,4],
           mod17xf_out$results$parameters$ci.unstandardized[17,4])

upper <- c(mod16_out$results$parameters$ci.unstandardized[6,8],
           mod16_out$results$parameters$ci.unstandardized[4,8],
           mod16_out$results$parameters$ci.unstandardized[5,8],
           
           mod20q4_out$results$parameters$ci.unstandardized[5,8],
           mod20q4_out$results$parameters$ci.unstandardized[12,8],
           mod20q4_out$results$parameters$ci.unstandardized[19,8],
           mod20q4_out$results$parameters$ci.unstandardized[26,8],
           mod20q4_out$results$parameters$ci.unstandardized[4,8],
           mod20q4_out$results$parameters$ci.unstandardized[11,8],
           mod20q4_out$results$parameters$ci.unstandardized[18,8],
           mod20q4_out$results$parameters$ci.unstandardized[25,8],
           
           mod17xf_out$results$parameters$ci.unstandardized[6,8],
           mod17xf_out$results$parameters$ci.unstandardized[4,8],
           mod17xf_out$results$parameters$ci.unstandardized[8,8],
           mod17xf_out$results$parameters$ci.unstandardized[3,8],
           mod17xf_out$results$parameters$ci.unstandardized[7,8],           
           
           mod17xf_out$results$parameters$ci.unstandardized[16,8],
           mod17xf_out$results$parameters$ci.unstandardized[14,8],
           mod17xf_out$results$parameters$ci.unstandardized[18,8],
           mod17xf_out$results$parameters$ci.unstandardized[13,8],
           mod17xf_out$results$parameters$ci.unstandardized[17,8])


df <- data.frame(label, mean, lower, upper)

# reverses the factor level ordering for labels after coord_flip()
df$label <- factor(df$label, levels=rev(df$label))

fp <- ggplot(data=df, aes(x=label, y=mean, ymin=lower, ymax=upper, label=mean)) +
  geom_pointrange(size=2,linewidth=2) + 
  geom_hline(yintercept=0, lty=2) +  # add a dotted line at x=1 after flip
  geom_vline(xintercept=5.75, lty=1) +
  geom_vline(xintercept=10.75, lty=1) +
  #geom_vline(xintercept=14.75, lty=1) +
  geom_vline(xintercept=18.75, lty=1) +
  annotate("text", x= 21.25, y = -2.10, label= "Panel A", size=10, fontface =2)+
  annotate("text", x= 18.45, y = -2.10, label= "Panel B", size=10, fontface =2)+
  annotate("text", x= 10.45, y = -2.10, label= "Panel C", size=10, fontface =2)+
  annotate("text", x= 5.45, y = -2.10, label= "Panel D", size=10, fontface =2)+
 # annotate("text", x= 1.35, y = -.60, label= "Panel E", size=10, fontface =2)+
  coord_flip(ylim=c(-1.5,1.25), clip="off") +  # flip coordinates (puts labels on y axis)
  xlab("") + ylab("Effect of PGI and childhood inequality accounting for GDP (95% CI)") +
  geom_text(vjust = -.75, nudge_y = 0, size=8)+
  theme_bw() +
    theme(legend.box.background=element_blank(),
        legend.background=element_rect(fill="transparent",size=.5),
        axis.text.x=element_text(colour="black", size=24),
        axis.text.y=element_text(colour="black", size=24),
        axis.title.x=element_text(colour="black", size=24),
        axis.title.y=element_text(colour="black", size=24),
        plot.title=element_text(size=18),
        panel.background=element_blank(),
     #   panel.grid.major=element_blank(),
    #    panel.grid.minor=element_blank(),
        panel.grid.minor.y=element_blank(),
        panel.grid.major.y=element_blank(),
    #    panel.grid.major.x=element_blank(),
    #    panel.grid.minor.x=element_blank(),
        panel.border=element_rect(colour="black", size=.75),
        strip.background=element_blank(),
        strip.text=element_text(size=20),
        axis.line.x=element_line(size=1),
        axis.line.y=element_line(size=1),
        legend.text=element_text(size=20),
        legend.key.width=unit(3,"line"),
        legend.title=element_blank(),
        legend.direction="vertical",
        #       plot.title= element_text(hjust=-.45, vjust=2.12),
        legend.position=c("bottom"),
        legend.key=element_blank())# use a white background


print(fp)

ggsave("/Users/chge2377/Dropbox/Files/GE Interplay Project/GxE work/Depression PGS/figure PGI main.jpeg", fp, dpi=500, width=18, height=18, units=c("in"))
```

```         
```
